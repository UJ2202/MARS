
================================================================================
  CMBAGENT STAGES 1-9 COMPREHENSIVE TEST SUITE
================================================================================

Start Time: 2026-01-15T08:44:26.686404
Database: /home/ujjwal/.cmbagent/cmbagent.db

================================================================================
  STAGE 1-2: FOUNDATION (AG2 Upgrade + Database)
================================================================================

  Testing: AG2 Import and Version... ✓ PASS

  Testing: CMBAgent Utils Import... <IPython.core.display.Image object>
<IPython.core.display.Markdown object>
✓ PASS

  Testing: Database Initialization... ✓ PASS

  Testing: Database Models Import... ✓ PASS

  Testing: Session Repository CRUD... ✓ PASS

  Testing: Workflow Repository CRUD... ✓ PASS

  Testing: Session Isolation... ✓ PASS

================================================================================
  STAGE 3-4: STATE MACHINE + DAG SYSTEM
================================================================================

  Testing: State Enumerations... ✓ PASS

  Testing: State Machine Transitions... ✗ FAIL
    Error: Unknown entity type: 7c6ae87f-c638-4872-84aa-68214f582c5c

  Testing: State History Tracking... ✗ FAIL
    Error: Unknown entity type: c3e2c6a9-b967-406e-b74f-4b8d399c8f94

  Testing: Workflow Controller (Pause/Resume)... ✓ PASS

  Testing: DAG Builder... ✗ FAIL
    Error: cannot import name 'DAGBuilder' from 'cmbagent.database' (/srv/projects/mas/mars/denario/cmbagent/cmbagent/database/__init__.py)

  Testing: Topological Sort... ✗ FAIL
    Error: cannot import name 'DAGBuilder' from 'cmbagent.database' (/srv/projects/mas/mars/denario/cmbagent/cmbagent/database/__init__.py)

  Testing: DAG Visualizer... ✗ FAIL
    Error: cannot import name 'DAGBuilder' from 'cmbagent.database' (/srv/projects/mas/mars/denario/cmbagent/cmbagent/database/__init__.py)

================================================================================
  STAGE 5: WEBSOCKET PROTOCOL
================================================================================

  Testing: WebSocket Event Types... ✗ FAIL
    Error: cannot import name 'EventType' from 'backend.websocket_events' (/srv/projects/mas/mars/denario/cmbagent/backend/websocket_events.py)

  Testing: Event Queue... ✗ FAIL
    Error: create_workflow_started_event() missing 2 required positional arguments: 'agent' and 'model'

  Testing: Event Serialization... ✗ FAIL
    Error: cannot import name 'create_step_completed_event' from 'backend.websocket_events' (/srv/projects/mas/mars/denario/cmbagent/backend/websocket_events.py)

================================================================================
  STAGE 6: HITL APPROVAL SYSTEM
================================================================================

  Testing: Approval Types... ✗ FAIL
    Error: cannot import name 'ApprovalMode' from 'cmbagent.database' (/srv/projects/mas/mars/denario/cmbagent/cmbagent/database/__init__.py)

  Testing: Approval Manager... ✗ FAIL
    Error: cannot import name 'ApprovalManager' from 'cmbagent.database' (/srv/projects/mas/mars/denario/cmbagent/cmbagent/database/__init__.py)

  Testing: Approval Resolution... ✗ FAIL
    Error: cannot import name 'ApprovalManager' from 'cmbagent.database' (/srv/projects/mas/mars/denario/cmbagent/cmbagent/database/__init__.py)

================================================================================
  STAGE 7: CONTEXT-AWARE RETRY MECHANISM
================================================================================

  Testing: Error Pattern Analyzer... ✗ FAIL
    Error: 'dict' object has no attribute 'category'

  Testing: Retry Context Creation... ✗ FAIL
    Error: 2 validation errors for RetryContext
original_task
  Field required [type=missing, input_value={'current_attempt': 2, 'm...', 'backoff_seconds': 4}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.12/v/missing
common_error
  Field required [type=missing, input_value={'current_attempt': 2, 'm...', 'backoff_seconds': 4}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.12/v/missing

  Testing: Retry Context Manager... ✗ FAIL
    Error: WorkflowRepository.create_step() takes 4 positional arguments but 5 were given

  Testing: Retry Metrics... ✗ FAIL
    Error: RetryMetrics.__init__() takes 2 positional arguments but 3 were given

================================================================================
  STAGE 8: PARALLEL EXECUTION
================================================================================

  Testing: Dependency Graph... ✓ PASS

  Testing: Work Directory Manager... ✗ FAIL
    Error: WorkDirectoryManager.__init__() missing 1 required positional argument: 'run_id'

  Testing: Resource Manager... ✗ FAIL
    Error: ResourceManager.__init__() got an unexpected keyword argument 'max_concurrent'

  Testing: Execution Configuration... ✓ PASS

================================================================================
  STAGE 9: BRANCHING AND PLAY-FROM-NODE
================================================================================

  Testing: Branch Manager... ✗ FAIL
    Error: WorkflowRepository.create_step() takes 4 positional arguments but 5 were given

  Testing: Branch Comparator... ✗ FAIL
    Error: 

  Testing: Play-from-Node Executor... ✗ FAIL
    Error: DAGRepository.create_node() takes 4 positional arguments but 5 were given

================================================================================
  TEST EXECUTION SUMMARY
================================================================================

Total Tests: 31
Passed: 11 ✓
Failed: 20 ✗
Skipped: 0

Failed Tests:
  - State Machine Transitions: Unknown entity type: 7c6ae87f-c638-4872-84aa-68214f582c5c
  - State History Tracking: Unknown entity type: c3e2c6a9-b967-406e-b74f-4b8d399c8f94
  - DAG Builder: cannot import name 'DAGBuilder' from 'cmbagent.database' (/srv/projects/mas/mars/denario/cmbagent/cmbagent/database/__init__.py)
  - Topological Sort: cannot import name 'DAGBuilder' from 'cmbagent.database' (/srv/projects/mas/mars/denario/cmbagent/cmbagent/database/__init__.py)
  - DAG Visualizer: cannot import name 'DAGBuilder' from 'cmbagent.database' (/srv/projects/mas/mars/denario/cmbagent/cmbagent/database/__init__.py)
  - WebSocket Event Types: cannot import name 'EventType' from 'backend.websocket_events' (/srv/projects/mas/mars/denario/cmbagent/backend/websocket_events.py)
  - Event Queue: create_workflow_started_event() missing 2 required positional arguments: 'agent' and 'model'
  - Event Serialization: cannot import name 'create_step_completed_event' from 'backend.websocket_events' (/srv/projects/mas/mars/denario/cmbagent/backend/websocket_events.py)
  - Approval Types: cannot import name 'ApprovalMode' from 'cmbagent.database' (/srv/projects/mas/mars/denario/cmbagent/cmbagent/database/__init__.py)
  - Approval Manager: cannot import name 'ApprovalManager' from 'cmbagent.database' (/srv/projects/mas/mars/denario/cmbagent/cmbagent/database/__init__.py)
  - Approval Resolution: cannot import name 'ApprovalManager' from 'cmbagent.database' (/srv/projects/mas/mars/denario/cmbagent/cmbagent/database/__init__.py)
  - Error Pattern Analyzer: 'dict' object has no attribute 'category'
  - Retry Context Creation: 2 validation errors for RetryContext
original_task
  Field required [type=missing, input_value={'current_attempt': 2, 'm...', 'backoff_seconds': 4}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.12/v/missing
common_error
  Field required [type=missing, input_value={'current_attempt': 2, 'm...', 'backoff_seconds': 4}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.12/v/missing
  - Retry Context Manager: WorkflowRepository.create_step() takes 4 positional arguments but 5 were given
  - Retry Metrics: RetryMetrics.__init__() takes 2 positional arguments but 3 were given
  - Work Directory Manager: WorkDirectoryManager.__init__() missing 1 required positional argument: 'run_id'
  - Resource Manager: ResourceManager.__init__() got an unexpected keyword argument 'max_concurrent'
  - Branch Manager: WorkflowRepository.create_step() takes 4 positional arguments but 5 were given
  - Branch Comparator: 
  - Play-from-Node Executor: DAGRepository.create_node() takes 4 positional arguments but 5 were given

Pass Rate: 35.5%

✗ SOME TESTS FAILED
================================================================================
